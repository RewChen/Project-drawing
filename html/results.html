<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ผลการค้นหา | Tasty Bar</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="icon" type="image/png" href="/main/img/logo.png">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --brand-red:#a51212;
      --glass-bg: rgba(255,255,255,.78);
      --glass-brd: rgba(255,255,255,.55);
    }
    html,body{height:100%;}
    body{
      background:
        linear-gradient(0deg, rgba(0,0,0,.55), rgba(0,0,0,.55)),
        url('band.jpg') center/cover no-repeat fixed;
      color:#1a1a1a;
    }
    nav {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px;
    background-color: #fff;

}

.menu {
    display: flex;
    list-style: none;
}

.menu li {
    margin-left: 20px;
    padding-right: 30px;
}

.menu li a {
    text-decoration: none;
    font-size: 18px;
    color: #000;
}
    .glass-card{
      background: var(--glass-bg);
      border: 1px solid var(--glass-brd);
      border-radius: 1.25rem;
      box-shadow: 0 10px 35px rgba(0,0,0,.25);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    .btn-brand{background:#a51212;border-color:#a51212;}
    .btn-brand:hover{background:#8f0f0f;border-color:#8f0f0f;}
    .result-item{
      border:1px solid rgba(0,0,0,.15);
      border-radius:.75rem;
      padding:1rem;
      position:relative;
      background:#fff;
    }
    .close-line{
      position:absolute; right:.5rem; top:.5rem;
      border:none; background:transparent; font-size:1.1rem; line-height:1;
      opacity:.65;
    }
    .close-line:hover{opacity:1}
    main{padding-top:min(7vh,48px); padding-bottom:min(7vh,48px);}
    .logo-pill{width:46px;height:46px;border-radius:50%;display:grid;place-items:center;
      font-weight:700;background:#000;color:#ffd54d;box-shadow:0 2px 8px rgba(0,0,0,.35);}
  </style>
</head>
<body>

   <nav>
        <div class="logo">
            <img src="/main/img/logo.png" alt="logo">
        </div>

        <ul class="menu">
            <li><a href="">เข้าสู่ระบบ</a></li>
            <li><a href="">หน้าหลัก</a></li>
            <li><a href="">แจ้งเตือน</a></li>
            <li><a href="">ติดต่อเรา</a></li>
        </ul>
    </nav>  

  <main class="d-flex justify-content-center">
    <div class="container">
      <div class="glass-card p-4 p-sm-5 mx-auto" style="max-width:980px">
        <h1 class="h5 fw-bold mb-3">ผลการค้นหา</h1>
        <p class="mb-4 text-secondary" id="criteriaText">—</p>

        <!-- ตารางหัว -->
        <div class="table-responsive mb-3">
          <table class="table align-middle mb-0">
            <thead>
              <tr>
                <th style="width:60%">ชื่อ</th>
                <th style="width:25%">วัน/เดือน/ปี</th>
                <th style="width:15%" class="text-end">ดำเนินการ</th>
              </tr>
            </thead>
            <tbody id="resultTableBody">
              <!-- แทรกด้วย JS -->
            </tbody>
          </table>
        </div>

        <!-- ถ้าไม่พบ -->
        <div id="emptyState" class="alert alert-warning d-none rounded-3">
          ไม่พบข้อมูลการจองตามเงื่อนไขที่ระบุ
        </div>

        <div class="d-flex gap-2 mt-4">
          <a href="index.html" class="btn btn-outline-dark rounded-3">กลับไปค้นหา</a>
          <button id="newSearch" class="btn btn-brand rounded-3">เริ่มค้นหาใหม่</button>
        </div>
      </div>
    </div>
  </main>

  <footer class="text-center text-white-50 small py-4">
    © <span id="y"></span> Tasty Bar
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    document.getElementById('y').textContent = new Date().getFullYear();

    // ---- 1) รับค่าจาก URL ----
    const params = new URLSearchParams(window.location.search);
    const qName  = (params.get('name')  || '').trim();
    const qPhone = (params.get('phone') || '').trim();
    document.getElementById('criteriaText').textContent =
      `คำค้นหา — ชื่อ: "${qName || '-'}" · เบอร์โทร: "${qPhone || '-'}"`;

    // ---- 2) ข้อมูลตัวอย่าง (เดโม่) ----
    // ในงานจริง: fetch('/api/reservations/search', {method:'POST', body:JSON.stringify({name:qName, phone:qPhone})})
    const mockReservations = [
      { id: 'RSV-001', name: 'มั่งมีเงิน', phone: '0999999999', date: '18/4/2023' },
      { id: 'RSV-002', name: 'น้องออมสิน', phone: '0812345678', date: '05/05/2024' },
      { id: 'RSV-003', name: 'Thanakorn', phone: '0900000000', date: '12/09/2025' },
    ];

    // ---- 3) ฟิลเตอร์แบบง่ายจาก name/phone ----
    const results = mockReservations.filter(r => {
      const okName  = qName  ? r.name.toLowerCase().includes(qName.toLowerCase()) : true;
      const okPhone = qPhone ? r.phone.includes(qPhone) : true;
      return okName && okPhone;
    });

    const tbody = document.getElementById('resultTableBody');
    const empty = document.getElementById('emptyState');

    if (results.length === 0) {
      empty.classList.remove('d-none');
    } else {
      empty.classList.add('d-none');
      results.forEach(row => tbody.appendChild(renderRow(row)));
    }

    // วาดแถวผลลัพธ์ตามสไตล์ภาพตัวอย่าง
    function renderRow(row){
      const tr = document.createElement('tr');
      const tdName = document.createElement('td');
      const tdDate = document.createElement('td');
      const tdAction = document.createElement('td');
      tdAction.className = 'text-end';

      // กล่องการ์ดในช่องชื่อ (มีชื่อ + เบอร์ + ปุ่มดูข้อมูล)
      tdName.innerHTML = `
        <div class="result-item">
          <button class="close-line" title="ลบรายการ" aria-label="ลบ">×</button>
          <div class="small text-secondary mb-1">ชื่อผู้จอง</div>
          <div class="fw-semibold">${row.name}</div>
          <div class="mt-2">
            <span class="badge text-bg-dark rounded-pill px-3 py-2"> ${row.phone} </span>
          </div>
          <div class="mt-3">
            <a href="reservation-detail.html?id=${encodeURIComponent(row.id)}" class="btn btn-sm btn-outline-secondary rounded-3">
              ดูข้อมูลเพิ่มเติม
            </a>
          </div>
        </div>
      `;

      // วันที่ตามภาพ
      tdDate.textContent = row.date;

      // ปุ่ม action เผื่ออนาคต
      tdAction.innerHTML = `
        <a href="reservation-detail.html?id=${encodeURIComponent(row.id)}" class="btn btn-sm btn-brand rounded-3">เปิด</a>
      `;

      tr.appendChild(tdName);
      tr.appendChild(tdDate);
      tr.appendChild(tdAction);

      // ลบการ์ด
      tdName.querySelector('.close-line').addEventListener('click', () => {
        tr.remove();
        if (!tbody.children.length) empty.classList.remove('d-none');
      });

      return tr;
    }

    // ปุ่มเริ่มค้นหาใหม่ (ล้าง query แล้วกลับหน้าแรก)
    document.getElementById('newSearch').addEventListener('click', () => {
      window.location.href = 'index.html';
    });
  </script>
</body>
</html>
