<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>รายละเอียดการจอง | Tasty Bar</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link rel="icon" type="image/png" href="/img/logo.png">

  <style>
    :root{
      --glass-bg: rgba(255,255,255,.9);
      --glass-brd: rgba(255,255,255,.7);
      --brand-green:#2e7d32; --brand-green-dark:#256628;
      --brand-red:#a51212;   --brand-red-dark:#8f0f0f;
      --pill-green:#184b1b;  --pill-red:#6f1d1b;
    }
    *{box-sizing:border-box;margin:0;padding:0;font-family:'Noto Sans Thai',sans-serif;}

    /* NAVBAR ใหม่ */
    header{position:relative; z-index:3; padding:12px 0;}
    .nav-shell{background:#fff;border:1px solid rgba(0,0,0,.08);border-radius:14px;box-shadow:0 2px 8px rgba(0,0,0,.06);min-height:64px;}
    .brand-logo{width:56px;height:56px;object-fit:contain;border-radius:50%;}
    .nav-list{list-style:none;display:flex;align-items:center;gap:28px;margin:0;padding:0;}
    .nav-list a{text-decoration:none;color:#111;font-weight:700;letter-spacing:.2px;}
    .nav-list a:hover{opacity:.75;}
    @media (max-width:576px){ .brand-logo{width:48px;height:48px;} .nav-list{gap:16px;} .nav-list a{font-weight:600;} }

    /* BG & body */
    .hero-bg{position:fixed;inset:0;z-index:0;background:url('/img/bg-bar.jpg') center/cover no-repeat;}
    .hero-mask{position:fixed;inset:0;z-index:1;background:rgba(0,0,0,.35);backdrop-filter:saturate(120%) blur(2px);-webkit-backdrop-filter:saturate(120%) blur(2px);}
    .glass-card{background:var(--glass-bg);border:1px solid var(--glass-brd);border-radius:1.25rem;box-shadow:0 12px 40px rgba(0,0,0,.25);backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);}
    main{position:relative;z-index:2;padding-top:min(6vh,42px);padding-bottom:min(8vh,56px);}
    .pill-title{display:inline-block;padding:.35rem 1.25rem;border-radius:999px;background:var(--pill-green);color:#fff;font-weight:700;}
    .pill-title.red{background:var(--pill-red);}
    .btn-danger-brand{background:var(--brand-red);border-color:var(--brand-red);}
    .btn-danger-brand:hover{background:var(--brand-red-dark);border-color:var(--brand-red-dark);}
    .btn-success-brand{background:var(--brand-green);border-color:var(--brand-green);}
    .btn-success-brand:hover{background:var(--brand-green-dark);border-color:var(--brand-green-dark);}
    .field{white-space:pre-line; font-size:1.05rem;}

    .toast-center{
      position: fixed; left:50%; top:35%; transform:translate(-50%,-50%);
      z-index: 9999; background:#fde2e4; color:#5c2a2a;
      border:1px solid #f7c6ca; border-radius:.75rem;
      box-shadow:0 6px 26px rgba(0,0,0,.18);
      padding:.85rem 1.1rem; min-width:220px; text-align:center; display:none;
    }
  </style>
</head>
<body>
  <div class="hero-bg" aria-hidden="true"></div>
  <div class="hero-mask" aria-hidden="true"></div>

  <!-- NAVBAR ใหม่ -->
  <header>
  <div class="container-xxl">
    <div class="nav-shell d-flex align-items-center justify-content-between px-3 px-sm-4">
      <a href="/html/index.html" class="d-inline-flex align-items-center gap-2 text-decoration-none">
        <img src="/img/logo.png" alt="Tasty Bar" class="brand-logo">
      </a>
      <nav aria-label="primary">
        <ul class="nav-list">
          <li><a href="/html/login.html">เข้าสู่ระบบ</a></li>
          <li><a href="/html/index.html">หน้าหลัก</a></li>
          <li><a href="/html/notifications.html">แจ้งเตือน</a></li>
          <li><a href="/html/contact.html">ติดต่อเรา</a></li>
        </ul>
      </nav>
    </div>
  </div>
</header>

  <main class="d-flex justify-content-center">
    <div class="container">
      <div class="glass-card p-4 p-sm-5 mx-auto" style="max-width:820px">
        <div class="text-center mb-3">
          <span id="titlePill" class="pill-title">รายละเอียดการจอง</span>
        </div>

        <div id="detail" class="field mb-4">กำลังโหลด…</div>

        <!-- ฟอร์มยกเลิก (ซ่อนก่อน) -->
        <div id="cancelBox" class="mb-4 d-none">
          <span class="pill-title red mb-2 d-inline-block">ยกเลิกการจอง</span>
          <div class="mt-2"></div>
          <label for="cancelReason" class="form-label">ระบุเหตุผล</label>
          <textarea id="cancelReason" class="form-control" rows="3" placeholder="เปลี่ยนใจ / เอกสารไม่ครบ / ..."></textarea>
        </div>

        <div class="d-flex justify-content-between gap-2">
          <div class="d-flex gap-2">
            <button id="btnCancel" class="btn btn-danger-brand rounded-3 px-4">ยกเลิก</button>
            <button id="btnRestore" class="btn btn-outline-secondary rounded-3 px-4 d-none">กู้คืน</button>
          </div>
          <button id="btnOk" class="btn btn-success-brand rounded-3 px-4">ตกลง</button>
        </div>

        <div class="text-center mt-3">
          <a href="/html/notifications.html" class="small text-decoration-none">กลับไปหน้าการแจ้งเตือน</a>
        </div>
      </div>
    </div>
  </main>

  <div id="toast" class="toast-center">ดำเนินการสำเร็จ</div>

  <footer class="text-center text-white-50 small py-4">
    © <span id="y"></span> Tasty Bar
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    document.getElementById('y').textContent = new Date().getFullYear();

    // ===== DB helpers (ใช้ชุดเดียวกับ notifications.html) =====
    const KEY = 'reservations';
    function loadAll(){ try{return JSON.parse(localStorage.getItem(KEY))||[]}catch{return[]} }
    function saveAll(list){ localStorage.setItem(KEY, JSON.stringify(list)); }
    function getOne(id){ return loadAll().find(x=>x.id===id); }
    function updateStatus(id, status, cancelReason=''){
      const all = loadAll(); const i = all.findIndex(x=>x.id===id);
      if(i>-1){ 
        all[i].status = status; 
        if(status === 'pending') delete all[i].cancelReason;
        if(cancelReason) all[i].cancelReason = cancelReason; 
        saveAll(all); 
        return all[i];
      }
      return null;
    }

    // ===== Read id & show =====
    const params = new URLSearchParams(window.location.search);
    const id = params.get('id');
    const data = getOne(id);

    const detail = document.getElementById('detail');
    const cancelBox = document.getElementById('cancelBox');
    const toastEl = document.getElementById('toast');
    const titlePill = document.getElementById('titlePill');
    const btnCancel = document.getElementById('btnCancel');
    const btnOk = document.getElementById('btnOk');
    const btnRestore = document.getElementById('btnRestore');

    function showToast(msg){
      toastEl.textContent = msg;
      toastEl.style.display = 'block';
      setTimeout(()=> toastEl.style.display='none', 1200);
    }

    if(!data){
      detail.textContent = 'ไม่พบบันทึกการจองที่ระบุ';
      btnCancel.disabled = true; btnOk.disabled = true;
    }else{
      detail.textContent =
`โต๊ะ: ${data.table}
วันที่: ${data.date}
ชื่อ: ${data.name}
อีเมล: ${data.email}
เบอร์: ${data.phone}`;

      if(data.status !== 'pending'){
        btnRestore.classList.remove('d-none');
      }
    }

    // กด "ตกลง" -> confirm
    btnOk.addEventListener('click', ()=>{
      if(!data) return;
      updateStatus(id, 'confirmed');
      showToast('การจองสำเร็จ');
      setTimeout(()=> window.location.href = '/html/notifications.html', 900);
    });

    // กด “ยกเลิก” -> เปิดฟอร์ม/ยืนยัน
    let cancelMode = false;
    btnCancel.addEventListener('click', ()=>{
      if(!data) return;
      if(!cancelMode){
        cancelMode = true;
        cancelBox.classList.remove('d-none');
        titlePill.textContent = 'ยกเลิกการจอง';
        titlePill.classList.add('red');
        return;
      }
      const reason = (document.getElementById('cancelReason').value || '').trim();
      updateStatus(id, 'canceled', reason);
      showToast('ยกเลิกการจองสำเร็จ');
      setTimeout(()=> window.location.href = '/html/notifications.html', 900);
    });

    // กด “กู้คืน” -> กลับเป็น pending
    btnRestore.addEventListener('click', ()=>{
      if(!data) return;
      updateStatus(id, 'pending');
      showToast('กู้คืนรายการแล้ว');
      setTimeout(()=> window.location.href = '/html/notifications.html', 900);
    });
  </script>
</body>
</html>
